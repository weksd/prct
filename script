// script.js
console.log('script.js loaded');
// –î–∞–Ω–Ω—ã–µ –º–∞—Å—Ç–µ—Ä–æ–≤
const masters = [
    {
        id: 1,
        name: "–ê–Ω–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞",
        specialty: "–ñ–µ–Ω—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞",
        serviceType: "female-haircut",
        photo: "üë©",
        description: "–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã 10 –ª–µ—Ç. –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –º–æ–¥–Ω—ã–º —Å—Ç—Ä–∏–∂–∫–∞–º –∏ –æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏—é.",
        rating: "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ"
    },
    {
        id: 2,
        name: "–î–º–∏—Ç—Ä–∏–π –ò–≤–∞–Ω–æ–≤",
        specialty: "–ú—É–∂—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞",
        serviceType: "male-haircut",
        photo: "üë®",
        description: "–ú–∞—Å—Ç–µ—Ä –º—É–∂—Å–∫–∏—Ö —Å—Ç—Ä–∏–∂–µ–∫ —Å –æ–ø—ã—Ç–æ–º 8 –ª–µ—Ç. –ö–ª–∞—Å—Å–∏–∫–∞ –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏.",
        rating: "‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ"
    },
    {
        id: 3,
        name: "–ï–ª–µ–Ω–∞ –ü–µ—Ç—Ä–æ–≤–∞",
        specialty: "–ú–∞–Ω–∏–∫—é—Ä",
        serviceType: "manicure",
        photo: "üíÖ",
        description: "–ù–µ–π–ª-–º–∞—Å—Ç–µ—Ä –ø—Ä–µ–º–∏—É–º –∫–ª–∞—Å—Å–∞. –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã 12 –ª–µ—Ç.",
        rating: "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ"
    }
];
// –£—Å–ª—É–≥–∏
const services = {
    "female-haircut": {
        title: "–ñ–µ–Ω—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞",
        description: "–°—Ç–∏–ª—å–Ω—ã–µ –∏ –º–æ–¥–Ω—ã–µ —Å—Ç—Ä–∏–∂–∫–∏ –¥–ª—è –∂–µ–Ω—â–∏–Ω",
        price: "–æ—Ç 1500 —Ä—É–±."
    },
    "male-haircut": {
        title: "–ú—É–∂—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞",
        description: "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º—É–∂—Å–∫–∏–µ —Å—Ç—Ä–∏–∂–∫–∏",
        price: "–æ—Ç 800 —Ä—É–±."
    },
    "manicure": {
        title: "–ú–∞–Ω–∏–∫—é—Ä",
        description: "–£—Ö–æ–∂–µ–Ω–Ω—ã–µ –∏ –∫—Ä–∞—Å–∏–≤—ã–µ –Ω–æ–≥—Ç–∏",
        price: "–æ—Ç 1200 —Ä—É–±."
    }
};
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
if (!localStorage.getItem('bookings')) {
    localStorage.setItem('bookings', JSON.stringify([]));
}
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM ready');

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');

    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');

            tabBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');

            tabContents.forEach(content => content.classList.remove('active'));
            const target = document.getElementById(tabId);
            if (target) target.classList.add('active');

            if (tabId === 'masters') loadAllMasters();
            if (tabId === 'home') resetBookingFlow();
            if (tabId === 'admin') {
                const loginBlock = document.getElementById('admin-login');
                const panel = document.getElementById('admin-panel');
                if (loginBlock) loginBlock.style.display = 'block';
                if (panel) panel.style.display = 'none';
            }
        });
    });

    // –í—ã–±–æ—Ä —É—Å–ª—É–≥–∏ (–æ–±–∞ –±–ª–æ–∫–∞) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
    const homeServicesContainer = document.querySelector('#home .services');
    const bookingServicesContainer = document.getElementById('services-selection');

    function serviceClickHandler(e) {
        const card = e.target.closest('.service-card');
        if (!card) return;
        const serviceType = card.getAttribute('data-service');
        if (!serviceType) return;
        selectService(serviceType);
        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É –∑–∞–ø–∏—Å–∏
        const bookingTabBtn = document.querySelector('[data-tab="booking"]');
        if (bookingTabBtn) bookingTabBtn.click();
    }

    if (homeServicesContainer) homeServicesContainer.addEventListener('click', serviceClickHandler);
    if (bookingServicesContainer) bookingServicesContainer.addEventListener('click', serviceClickHandler);

    // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥ –∫ —É—Å–ª—É–≥–∞–º"
    const backToServicesBtn = document.getElementById('back-to-services');
    if (backToServicesBtn) backToServicesBtn.addEventListener('click', resetBookingFlow);

    // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥ –∫ –º–∞—Å—Ç–µ—Ä–∞–º"
    const backToMastersBtn = document.getElementById('back-to-masters');
    if (backToMastersBtn) backToMastersBtn.addEventListener('click', function() {
        const formContainer = document.getElementById('booking-form-container');
        const serviceSelection = document.getElementById('service-selection');
        if (formContainer) formContainer.style.display = 'none';
        if (serviceSelection) serviceSelection.style.display = 'block';
    });

    // –§–æ—Ä–º–∞ –∑–∞–ø–∏—Å–∏
    const bookingForm = document.getElementById('booking-form');
    if (bookingForm) {
        bookingForm.addEventListener('submit', function(e) {
            e.preventDefault();
            createBooking();
        });
    }

    // –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    const loginForm = document.getElementById('login-form');
    if (loginForm) {
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const login = document.getElementById('login').value;
            const password = document.getElementById('password').value;

            if (login === 'admin' && password === 'admin123') {
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                loadAdminBookings();
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!');
            }
        });
    }

    // –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
            document.getElementById('admin-login').style.display = 'block';
            document.getElementById('admin-panel').style.display = 'none';
            if (loginForm) loginForm.reset();
        });
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    const closeModalBtn = document.getElementById('close-modal');
    if (closeModalBtn) {
        closeModalBtn.addEventListener('click', function() {
            const modal = document.getElementById('success-modal');
            if (modal) modal.style.display = 'none';
            resetBookingFlow();
        });
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞—Å—Ç–µ—Ä–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadAllMasters();
});

function selectService(serviceType) {
    const service = services[serviceType];
    if (!service) return;
    const serviceMasters = masters.filter(master => master.serviceType === serviceType);

const servicesSelection = document.getElementById('services-selection');
const serviceSelection = document.getElementById('service-selection');
const selectedTitle = document.getElementById('selected-service-title');
const mastersList = document.getElementById('masters-list');


    if (servicesSelection) servicesSelection.style.display = 'none';
    if (serviceSelection) serviceSelection.style.display = 'block';
    if (selectedTitle) selectedTitle.textContent = service.title;
    if (mastersList) mastersList.innerHTML = '';

    serviceMasters.forEach(master => {
        const masterCard = document.createElement('div');
        masterCard.className = 'master-card';
        masterCard.innerHTML = `
            <div class="master-photo">${master.photo}</div>
            <h3>${master.name}</h3>
            <p class="master-specialty">${master.specialty}</p>
            <p>${master.description}</p>
            <p><strong>–†–µ–π—Ç–∏–Ω–≥:</strong> ${master.rating}</p>
            <p><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> ${service.price}</p>
            <button class="btn-primary book-master-btn" data-master-id="${master.id}">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
        `;
        mastersList.appendChild(masterCard);
    });

    // –í–µ—à–∞–µ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –Ω–æ —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –≤–µ—à–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫–∏
    if (mastersList) {
        mastersList.addEventListener('click', function handler(e) {
            const btn = e.target.closest('.book-master-btn');
            if (!btn) return;
            const masterId = btn.getAttribute('data-master-id');
            selectMaster(masterId, serviceType);
        }, { once: false });
    }
}

function selectMaster(masterId, serviceType) {
    document.getElementById('selected-master-id').value = masterId;
    document.getElementById('selected-service-type').value = serviceType;

    const serviceSelection = document.getElementById('service-selection');
    const formContainer = document.getElementById('booking-form-container');
    if (serviceSelection) serviceSelection.style.display = 'none';
    if (formContainer) formContainer.style.display = 'block';

    const today = new Date().toISOString().split('T')[0];
    const dateInput = document.getElementById('booking-date');
    if (dateInput) {
        dateInput.min = today;
        dateInput.value = today;
    }
}

function createBooking() {
    const masterId = parseInt(document.getElementById('selected-master-id').value, 10);
    const serviceType = document.getElementById('selected-service-type').value;
    const clientName = document.getElementById('client-name').value;
    const clientPhone = document.getElementById('client-phone').value;
    const bookingDate = document.getElementById('booking-date').value;
    const bookingTime = document.getElementById('booking-time').value;

    const master = masters.find(m => m.id === masterId);
    const service = services[serviceType];

    if (!master || !service) {
        alert('–û—à–∏–±–∫–∞: –º–∞—Å—Ç–µ—Ä –∏–ª–∏ —É—Å–ª—É–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.');
        return;
    }

    const booking = {
        id: Date.now(),
        masterId: masterId,
        masterName: master.name,
        serviceType: serviceType,
        serviceName: service.title,
        clientName: clientName,
        clientPhone: clientPhone,
        date: bookingDate,
        time: bookingTime,
        status: 'pending',
        createdAt: new Date().toISOString()
    };

    const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
    bookings.push(booking);
    localStorage.setItem('bookings', JSON.stringify(bookings));

    const modal = document.getElementById('success-modal');
    if (modal) modal.style.display = 'flex';

    const bookingForm = document.getElementById('booking-form');
    if (bookingForm) bookingForm.reset();
}

function loadAllMasters() {
    const mastersGrid = document.getElemen
tById('all-masters');
    if (!mastersGrid) return;
    mastersGrid.innerHTML = '';

    masters.forEach(master => {
        const service = services[master.serviceType];
        const masterCard = document.createElement('div');
        masterCard.className = 'master-card';
        masterCard.innerHTML = `
            <div class="master-photo">${master.photo}</div>
            <h3>${master.name}</h3>
            <p class="master-specialty">${master.specialty}</p>
            <p>${master.description}</p>
            <p><strong>–†–µ–π—Ç–∏–Ω–≥:</strong> ${master.rating}</p>
            <p><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏:</strong> ${service ? service.price : ''}</p>
            <button class="btn-primary book-from-masters" data-service="${master.serviceType}">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
        `;
        mastersGrid.appendChild(masterCard);
    });

    // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ç–∫—É –º–∞—Å—Ç–µ—Ä–æ–≤
    mastersGrid.addEventListener('click', function(e) {
        const btn = e.target.closest('.book-from-masters');
        if (!btn) return;
        const serviceType = btn.getAttribute('data-service');
        const bookingTabBtn = document.querySelector('[data-tab="booking"]');
        if (bookingTabBtn) bookingTabBtn.click();
        selectService(serviceType);
    });
}

function loadAdminBookings() {
    const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
    const adminBookings = document.getElementById('admin-bookings');

    if (!adminBookings) return;

    if (bookings.length === 0) {
        adminBookings.innerHTML = '<p>–ó–∞–ø–∏—Å–µ–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>';
        return;
    }

    adminBookings.innerHTML = '';

    bookings.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

    bookings.forEach(booking => {
        const bookingCard = document.createElement('div');
        bookingCard.className = 'booking-card';
        bookingCard.innerHTML = `
            <div class="booking-header">
                <h3>${booking.clientName}</h3>
                <span class="status ${booking.status}">${booking.status === 'pending' ? '–û–∂–∏–¥–∞–µ—Ç' : '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞'}</span>
            </div>
            <p><strong>–£—Å–ª—É–≥–∞:</strong> ${booking.serviceName}</p>
            <p><strong>–ú–∞—Å—Ç–µ—Ä:</strong> ${booking.masterName}</p>
            <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${booking.clientPhone}</p>
            <p><strong>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</strong> ${booking.date} ${booking.time}</p>
            <p><strong>–°–æ–∑–¥–∞–Ω–∞:</strong> ${new Date(booking.createdAt).toLocaleString()}</p>
            <div class="booking-actions">
                ${booking.status === 'pending' ? `<button class="btn-primary confirm-booking" data-booking-id="${booking.id}">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>` : ''}
                <button class="btn-secondary delete-booking" data-booking-id="${booking.id}">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        `;
        adminBookings.appendChild(bookingCard);
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
    adminBookings.addEventListener('click', function(e) {
        const confirmBtn = e.target.closest('.confirm-booking');
        if (confirmBtn) {
            const bookingId = parseInt(confirmBtn.getAttribute('data-booking-id'), 10);
            confirmBooking(bookingId);
            return;
        }
        const deleteBtn = e.target.closest('.delete-booking');
        if (deleteBtn) {
            const bookingId = parseInt(deleteBtn.getAttribute('data-booking-id'), 10);
            deleteBooking(bookingId);
        }
    });
}

function confirmBooking(bookingId) {
    const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
    const bookingIndex = bookings.findIndex(b => b.id === bookingId);

    if (bookingIndex !== -1) {
bookings[bookingIndex].status = 'confirmed';
        localStorage.setItem('bookings', JSON.stringify(bookings));
        loadAdminBookings();
    }
}

function deleteBooking(bookingId) {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?')) return;
    const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
    const filteredBookings = bookings.filter(b => b.id !== bookingId);
    localStorage.setItem('bookings', JSON.stringify(filteredBookings));
    loadAdminBookings();
}

function resetBookingFlow() {
    const servicesSelection = document.getElementById('services-selection');
    const serviceSelection = document.getElementById('service-selection');
    const formContainer = document.getElementById('booking-form-container');
    if (servicesSelection) servicesSelection.style.display = 'block';
    if (serviceSelection) serviceSelection.style.display = 'none';
    if (formContainer) formContainer.style.display = 'none';
}
